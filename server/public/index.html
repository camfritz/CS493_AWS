<html>
	<title>Test Page</title>
	<head>
		<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
		<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
		<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>



		<link rel="stylesheet" href="./css/styles.css">

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="		sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="		sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

		<meta name="viewport" content="width=device-width, initial-scale=1">

		<script src="https://www.gstatic.com/firebasejs/5.8.5/firebase.js"></script>

		<script>
  		// Initialize Firebase
  		var config = {
    		apiKey: "AIzaSyDzp232w9Hw9Yq7skzFcD_py1qo3hHFuwQ",
    		authDomain: "cs493-aws.firebaseapp.com",
    		databaseURL: "https://cs493-aws.firebaseio.com",
   		 	projectId: "cs493-aws",
    		storageBucket: "",
    		messagingSenderId: "692734195804"
  		};
  		firebase.initializeApp(config);
		</script>

		<script>
			function googleSignInAuth() {
				var provider = new firebase.auth.GoogleAuthProvider();

				firebase.auth().signInWithPopup(provider)
				.then(function(result) {
					document.getElementById("content-container").style.visibility = "visible";
						$.get("http://3.86.118.204:3000/genres", function(data, status) {
							for(var i = 0; i < data.length; i++) {
								$("#Items").append(`<a class="list_item" onclick="showArtists(event);">${data[i]}</a><br>`)
							}
						});


						$.get("http://3.86.118.204:3000/", function(data, status) {
								$("#AudioItem").attr("src", data[0].url);
								var path = (data[0].key).split('/');
								$("#AudioItems").append(`<span>Artist: ${path[0]}</span><br>`)
								$("#AudioItems").append(`<span>Album: ${path[1]}</span><br>`)
								$("#AudioItems").append(`<span>Song: ${path[2]}</span><br>`)
						})

						var user = result.user;
						$.ajax({
							type: "POST",
							url: "http://3.86.118.204:3000/save-user",
							data: {
								id: user.uid,
								name: user.displayName,
								email: user.email
							},
							success: function() {
								console.log("Success!");
							}
						})
				})
			}

			function showArtists(e) {
				$.get(`http://3.86.118.204:3000/artists/for/genre?genre=${e.target.innerHTML}`, function(data, status) {
					$("#Items").empty();

					for(var i = 0; i < data.length; i++) {
						$("#Items").append(`<p class="list_item">${data[i]}</p><br>`)
					}
				})
			}

			function postElc() {
				console.log("Attempting ELC...");
				$.ajax({
					type: "POST",
					url: "http://3.86.118.204:3000/play",
					success: function() {
						console.log("Success with ELC!");
					}
				})
			}
		</script>

		<script>

			$(document).ready(function() {
				document.getElementById("content-container").style.visibility = "hidden";
				googleSignInAuth();
		});
		</script>
	</head>

	<body>
		<div id="content-container" class="row centered">
			<div class="col-md-4" id="Items">
			</div>
		</div>

		<div id="audio-container" class="row centered">
			<div class="col-md-4" id="AudioItems">
				<audio id="AudioItem" src="" controls="controls"></audio>
			</div>

			<button onclick="postElc()">ELC Test</button>
	</body>

</html>

<script>
						// var obj = {};

					// data.forEach(function(path) {
					// 	(path.key).split('/').reduce(function(r, e) {
					// 		if(e.includes('.mp3')) {
					// 			return r[e] = path.url;
					// 		}
					// 		return r[e] || (r[e] = {})
					// 	}, obj)
					// })

					//http://3.86.118.204:3000/
</script>